"""Matrix equation solver routines"""
# Author: Jeffrey Armstrong <jeff@approximatrix.com>
# February 24, 2012

# Modified: Chad Fulton <ChadFulton@gmail.com>
# June 19, 2014

# Modified: Ilhan Polat <ilhanpolat@gmail.com>
# September 13, 2016

import warnings
import numpy as np
from numpy.linalg import inv, LinAlgError, norm, cond, svd

from .basic import solve, solve_triangular, matrix_balance
from .lapack import get_lapack_funcs
from .decomp_schur import schur
from .decomp_lu import lu
from .decomp_qr import qr
from ._decomp_qz import ordqz
from .decomp import _asarray_validated
from .special_matrices import kron, block_diag

__all__ = ['solve_sylvester',
           'solve_continuous_lyapunov', 'solve_discrete_lyapunov',
           'solve_lyapunov',
           'solve_continuous_are', 'solve_discrete_are']


def solve_sylvester(a, b, q):
    """
    Computes a solution (X) to the Sylvester equation :math:`AX + XB = Q`.

    Parameters
    ----------
    a : (M, M) array_like
        Leading matrix of the Sylvester equation
    b : (N, N) array_like
        Trailing matrix of the Sylvester equation
    q : (M, N) array_like
        Right-hand side

    Returns
    -------
    x : (M, N) ndarray
        The solution to the Sylvester equation.

    Raises
    ------
    LinAlgError
        If solution was not found

    Notes
    -----
    Computes a solution to the Sylvester matrix equation via the Bartels-
    Stewart algorithm. The A and B matrices first undergo Schur
    decompositions. The resulting matrices are used to construct an
    alternative Sylvester equation (``RY + YS^T = F``) where the R and S
    matrices are in quasi-triangular form (or, when R, S or F are complex,
    triangular form). The simplified equation is then solved using
    ``*TRSYL`` from LAPACK directly.

    .. versionadded:: 0.11.0

    Examples
    --------
    Given `a`, `b`, and `q` solve for `x`:

    >>> from scipy import linalg
    >>> a = np.array([[-3, -2, 0], [-1, -1, 3], [3, -5, -1]])
    >>> b = np.array([[1]])
    >>> q = np.array([[1],[2],[3]])
    >>> x = linalg.solve_sylvester(a, b, q)
    >>> x
    array([[ 0.0625],
           [-0.5625],
           [ 0.6875]])
    >>> np.allclose(a.dot(x) + x.dot(b), q)
    True

    """

    # Compute the Schur decomposition form of a
    r, u = schur(a, output='real')

    # Compute the Schur decomposition of b
    s, v = schur(b.conj().transpose(), output='real')

    # Construct f = u'*q*v
    f = np.dot(np.dot(u.conj().transpose(), q), v)

    # Call the Sylvester equation solver
    trsyl, = get_lapack_funcs(('trsyl',), (r, s, f))
    if trsyl is None:
        raise RuntimeError('LAPACK implementation does not contain a proper '
                           'Sylvester equation solver (TRSYL)')
    y, scale, info = trsyl(r, s, f, tranb='C')

    y = scale*y

    if info < 0:
        raise LinAlgError("Illegal value encountered in "
                          "the %d term" % (-info,))

    return np.dot(np.dot(u, y), v.conj().transpose())


def solve_continuous_lyapunov(a, q):
    """
    Solves the continuous Lyapunov equation :math:`AX + XA^H = Q`.

    Uses the Bartels-Stewart algorithm to find :math:`X`.

    Parameters
    ----------
    a : array_like
        A square matrix

    q : array_like
        Right-hand side square matrix

    Returns
    -------
    x : ndarray
        Solution to the continuous Lyapunov equation

    See Also
    --------
    solve_discrete_lyapunov : computes the solution to the discrete-time
        Lyapunov equation
    solve_sylvester : computes the solution to the Sylvester equation

    Notes
    -----
    The continuous Lyapunov equation is a special form of the Sylvester
    equation, hence this solver relies on LAPACK routine ?TRSYL.

    .. versionadded:: 0.11.0

    Examples
    --------
    Given `a` and `q` solve for `x`:

    >>> from scipy import linalg
    >>> a = np.array([[-3, -2, 0], [-1, -1, 0], [0, -5, -1]])
    >>> b = np.array([2, 4, -1])
    >>> q = np.eye(3)
    >>> x = linalg.solve_continuous_lyapunov(a, q)
    >>> x
    array([[ -0.75  ,   0.875 ,  -3.75  ],
           [  0.875 ,  -1.375 ,   5.3125],
           [ -3.75  ,   5.3125, -27.0625]])
    >>> np.allclose(a.dot(x) + x.dot(a.T), q)
    True
    """

    a = np.atleast_2d(_asarray_validated(a, check_finite=True))
    q = np.atleast_2d(_asarray_validated(q, check_finite=True))

    r_or_c = float

    for ind, _ in enumerate((a, q)):
        if np.iscomplexobj(_):
            r_or_c = complex

        if not np.equal(*_.shape):
            raise ValueError("Matrix {} should be square.".format("aq"[ind]))

    # Shape consistency check
    if a.shape != q.shape:
        raise ValueError("Matrix a and q should have the same shape.")

    # Compute the Schur decomposition form of a
    r, u = schur(a, output='real')

    # Construct f = u'*q*u
    f = u.conj().T.dot(q.dot(u))

    # Call the Sylvester equation solver
    trsyl = get_lapack_funcs('trsyl', (r, f))

    dtype_string = 'T' if r_or_c == float else 'C'
    y, scale, info = trsyl(r, r, f, tranb=dtype_string)

    if info < 0:
        raise ValueError('?TRSYL exited with the internal error '
                         '"illegal value in argument number {}.". See '
                         'LAPACK documentation for the ?TRSYL error codes.'
                         ''.format(-info))
    elif info == 1:
        warnings.warn('Input "a" has an eigenvalue pair whose sum is '
                      'very close to or exactly zero. The solution is '
                      'obtained via perturbing the coefficients.',
                      RuntimeWarning)
    y *= scale

    return u.dot(y).dot(u.conj().T)


# For backwards compatibility, keep the old name
solve_lyapunov = solve_continuous_lyapunov


def _solve_discrete_lyapunov_direct(a, q):
    """
    Solves the discrete Lyapunov equation directly.

    This function is called by the `solve_discrete_lyapunov` function with
    `method=direct`. It is not supposed to be called directly.
    """

    lhs = kron(a, a.conj())
    lhs = np.eye(lhs.shape[0]) - lhs
    x = solve(lhs, q.flatten())

    return np.reshape(x, q.shape)


def _solve_discrete_lyapunov_bilinear(a, q):
    """
    Solves the discrete Lyapunov equation using a bilinear transformation.

    This function is called by the `solve_discrete_lyapunov` function with
    `method=bilinear`. It is not supposed to be called directly.
    """
    eye = np.eye(a.shape[0])
    aH = a.conj().transpose()
    aHI_inv = inv(aH + eye)
    b = np.dot(aH - eye, aHI_inv)
    c = 2*np.dot(np.dot(inv(a + eye), q), aHI_inv)
    return solve_lyapunov(b.conj().transpose(), -c)


def solve_discrete_lyapunov(a, q, method=None):
    """
    Solves the discrete Lyapunov equation :math:`AXA^H - X + Q = 0`.

    Parameters
    ----------
    a, q : (M, M) array_like
        Square matrices corresponding to A and Q in the equation
        above respectively. Must have the same shape.

    method : {'direct', 'bilinear'}, optional
        Type of solver.

        If not given, chosen to be ``direct`` if ``M`` is less than 10 and
        ``bilinear`` otherwise.

    Returns
    -------
    x : ndarray
        Solution to the discrete Lyapunov equation

    See Also
    --------
    solve_continuous_lyapunov : computes the solution to the continuous-time
        Lyapunov equation

    Notes
    -----
    This section describes the available solvers that can be selected by the
    'method' parameter. The default method is *direct* if ``M`` is less than 10
    and ``bilinear`` otherwise.

    Method *direct* uses a direct analytical solution to the discrete Lyapunov
    equation. The algorithm is given in, for example, [1]_. However, it requires
    the linear solution of a system with dimension :math:`M^2` so that
    performance degrades rapidly for even moderately sized matrices.

    Method *bilinear* uses a bilinear transformation to convert the discrete
    Lyapunov equation to a continuous Lyapunov equation :math:`(BX+XB'=-C)`
    where :math:`B=(A-I)(A+I)^{-1}` and
    :math:`C=2(A' + I)^{-1} Q (A + I)^{-1}`. The continuous equation can be
    efficiently solved since it is a special case of a Sylvester equation.
    The transformation algorithm is from Popov (1964) as described in [2]_.

    .. versionadded:: 0.11.0

    References
    ----------
    .. [1] Hamilton, James D. Time Series Analysis, Princeton: Princeton
       University Press, 1994.  265.  Print.
       http://doc1.lbfl.li/aca/FLMF037168.pdf
    .. [2] Gajic, Z., and M.T.J. Qureshi. 2008.
       Lyapunov Matrix Equation in System Stability and Control.
       Dover Books on Engineering Series. Dover Publications.

    Examples
    --------
    Given `a` and `q` solve for `x`:

    >>> from scipy import linalg
    >>> a = np.array([[0.2, 0.5],[0.7, -0.9]])
    >>> q = np.eye(2)
    >>> x = linalg.solve_discrete_lyapunov(a, q)
    >>> x
    array([[ 0.70872893,  1.43518822],
           [ 1.43518822, -2.4266315 ]])
    >>> np.allclose(a.dot(x).dot(a.T)-x, -q)
    True

    """
    a = np.asarray(a)
    q = np.asarray(q)
    if method is None:
        # Select automatically based on size of matrices
        if a.shape[0] >= 10:
            method = 'bilinear'
        else:
            method = 'direct'

    meth = method.lower()

    if meth == 'direct':
        x = _solve_discrete_lyapunov_direct(a, q)
    elif meth == 'bilinear':
        x = _solve_discrete_lyapunov_bilinear(a, q)
    else:
        raise ValueError('Unknown solver %s' % method)

    return x


def solve_continuous_are(a, b, q, r, e=None, s=None, balanced=True):
    r"""
    Solves the continuous-time algebraic Riccati equation (CARE).

    The CARE is defined as

    .. math::

          X A + A^H X - X B R^{-1} B^H X + Q = 0

    The limitations for a solution to exist are :

        * All eigenvalues of :math:`A` on the right half plane, should be
          controllable.

        * The associated hamiltonian pencil (See Notes), should have
          eigenvalues sufficiently away from the imaginary axis.

    Moreover, if ``e`` or ``s`` is not precisely ``None``, then the
    generalized version of CARE

    .. math::

          E^HXA + A^HXE - (E^HXB + S) R^{-1} (B^HXE + S^H) + Q = 0

    is solved. When omitted, ``e`` is assumed to be the identity and ``s``
    is assumed to be the zero matrix with sizes compatible with ``a`` and
    ``b``, respectively.

    Parameters
    ----------
    a : (M, M) array_like
        Square matrix
    b : (M, N) array_like
        Input
    q : (M, M) array_like
        Input
    r : (N, N) array_like
        Nonsingular square matrix
    e : (M, M) array_like, optional
        Nonsingular square matrix
    s : (M, N) array_like, optional
        Input
    balanced : bool, optional
        The boolean that indicates whether a balancing step is performed
        on the data. The default is set to True.

    Returns
    -------
    x : (M, M) ndarray
        Solution to the continuous-time algebraic Riccati equation.

    Raises
    ------
    LinAlgError
        For cases where the stable subspace of the pencil could not be
        isolated. See Notes section and the references for details.

    See Also
    --------
    solve_discrete_are : Solves the discrete-time algebraic Riccati equation

    Notes
    -----
    The equation is solved by forming the extended hamiltonian matrix pencil,
    as described in [1]_, :math:`H - \lambda J` given by the block matrices ::

        [ A    0    B ]             [ E   0    0 ]
        [-Q  -A^H  -S ] - \lambda * [ 0  E^H   0 ]
        [ S^H B^H   R ]             [ 0   0    0 ]

    and using a QZ decomposition method.

    In this algorithm, the fail conditions are linked to the symmetry
    of the product :math:`U_2 U_1^{-1}` and condition number of
    :math:`U_1`. Here, :math:`U` is the 2m-by-m matrix that holds the
    eigenvectors spanning the stable subspace with 2-m rows and partitioned
    into two m-row matrices. See [1]_ and [2]_ for more details.

    In order to improve the QZ decomposition accuracy, the pencil goes
    through a balancing step where the sum of absolute values of
    :math:`H` and :math:`J` entries (after removing the diagonal entries of
    the sum) is balanced following the recipe given in [3]_.

    .. versionadded:: 0.11.0

    References
    ----------
    .. [1]  P. van Dooren , "A Generalized Eigenvalue Approach For Solving
       Riccati Equations.", SIAM Journal on Scientific and Statistical
       Computing, Vol.2(2), :doi:`10.1137/0902010`

    .. [2] A.J. Laub, "A Schur Method for Solving Algebraic Riccati
       Equations.", Massachusetts Institute of Technology. Laboratory for
       Information and Decision Systems. LIDS-R ; 859. Available online :
       http://hdl.handle.net/1721.1/1301

    .. [3] P. Benner, "Symplectic Balancing of Hamiltonian Matrices", 2001,
       SIAM J. Sci. Comput., 2001, Vol.22(5), :doi:`10.1137/S1064827500367993`

    Examples
    --------
    Given `a`, `b`, `q`, and `r` solve for `x`:

    >>> from scipy import linalg
    >>> a = np.array([[4, 3], [-4.5, -3.5]])
    >>> b = np.array([[1], [-1]])
    >>> q = np.array([[9, 6], [6, 4.]])
    >>> r = 1
    >>> x = linalg.solve_continuous_are(a, b, q, r)
    >>> x
    array([[ 21.72792206,  14.48528137],
           [ 14.48528137,   9.65685425]])
    >>> np.allclose(a.T.dot(x) + x.dot(a)-x.dot(b).dot(b.T).dot(x), -q)
    True

    """

    # Validate input arguments
    a, b, q, r, e, s, m, n, r_or_c, gen_are = _are_validate_args(
                                                     a, b, q, r, e, s, 'care')

    H = np.empty((2*m+n, 2*m+n), dtype=r_or_c)
    H[:m, :m] = a
    H[:m, m:2*m] = 0.
    H[:m, 2*m:] = b
    H[m:2*m, :m] = -q
    H[m:2*m, m:2*m] = -a.conj().T
    H[m:2*m, 2*m:] = 0. if s is None else -s
    H[2*m:, :m] = 0. if s is None else s.conj().T
    H[2*m:, m:2*m] = b.conj().T
    H[2*m:, 2*m:] = r

    if gen_are and e is not None:
        J = block_diag(e, e.conj().T, np.zeros_like(r, dtype=r_or_c))
    else:
        J = block_diag(np.eye(2*m), np.zeros_like(r, dtype=r_or_c))

    if balanced:
        # xGEBAL does not remove the diagonals before scaling. Also
        # to avoid destroying the Symplectic structure, we follow Ref.3
        M = np.abs(H) + np.abs(J)
        M[np.diag_indices_from(M)] = 0.
        _, (sca, _) = matrix_balance(M, separate=1, permute=0)
        # do we need to bother?
        if not np.allclose(sca, np.ones_like(sca)):
            # Now impose diag(D,inv(D)) from Benner where D is
            # square root of s_i/s_(n+i) for i=0,....
            sca = np.log2(sca)
            # NOTE: Py3 uses "Bankers Rounding: round to the nearest even" !!
            s = np.round((sca[m:2*m] - sca[:m])/2)
            sca = 2 ** np.r_[s, -s, sca[2*m:]]
            # Elementwise multiplication via broadcasting.
            elwisescale = sca[:, None] * np.reciprocal(sca)
            H *= elwisescale
            J *= elwisescale

    # Deflate the pencil to 2m x 2m ala Ref.1, eq.(55)
    q, r = qr(H[:, -n:])
    H = q[:, n:].conj().T.dot(H[:, :2*m])
    J = q[:2*m, n:].conj().T.dot(J[:2*m, :2*m])

    # Decide on which output type is needed for QZ
    out_str = 'real' if r_or_c == float else 'complex'

    _, _, _, _, _, u = ordqz(H, J, sort='lhp', overwrite_a=True,
                             overwrite_b=True, check_finite=False,
                             output=out_str)

    # Get the relevant parts of the stable subspace basis
    if e is not None:
        u, _ = qr(np.vstack((e.dot(u[:m, :m]), u[m:, :m])))
    u00 = u[:m, :m]
    u10 = u[m:, :m]

    # Solve via back-substituion after checking the condition of u00
    up, ul, uu = lu(u00)
    if 1/cond(uu) < np.spacing(1.):
        raise LinAlgError('Failed to find a finite solution.')

    # Exploit the triangular structure
    x = solve_triangular(ul.conj().T,
                         solve_triangular(uu.conj().T,
                                          u10.conj().T,
                                          lower=True),
                         unit_diagonal=True,
                         ).conj().T.dot(up.conj().T)
    if balanced:
        x *= sca[:m, None] * sca[:m]

    # Check the deviation from symmetry for lack of success
    # See proof of Thm.5 item 3 in [2]
    u;t˜0¹ wš´)ƒòg+‹S-.ªu€ñ P[[bê8&G¯{¤šm«G\ÆÛOÈ5Vkòƒ'é³%>p"º2ïÓü¥ÄÈ]ÈğèĞÖ{B²BeêZÂ'ê’í#€ *1Ñ¸_YàÔOA~Äé §˜ÊöI[9 IA—Â{ì×º5H362¸ì`=„®pŒl®PòëÿM‰š¨Ğp3jçVÅ©¤nûLküayƒ¾}·}]ïÔïŒnwKŞ®®öSPn0D=£¤+ééûdò^ÉoG`ÄTËs…'ßøxm¯F»¬Î|ÇOd@nk-<}|<„§RUãıéN"ˆ™(dFÆZdMXÅÏ(ì¶""l Ÿá°ˆãİtr¦»`² ,`&¡e!OÁÆ…iØõ7 l³§øÀ¡İLb<jsZKî1TW(( +Ğ=t\ÕoäÑ7û*§$Ãöşk¸©‚uƒ¿B#è*â¥ë
Ízä"å`•a@ _ú×ÉÖ«‚jîj8LS­(<|èö ĞG#ß,gs6\­ L¼¢ï/~Ó68dÖ!öÓèüì¤2@Ã˜`·3Š*Èd[RqìbÍÈ(bÄ(wQC¢wC˜8õC¥Xy’/nSàâh Dèãîa—m’éyw‰wa?ªTVk>İ« ! 0Ñ¼E€ád£G:(vóô'ÏåªO<¥!¼º"§ƒdåyêºJ¦öÛ$Ø4Í&¶ ™KD.>wœ20è#¯¤"Üp°Ï^FÒœ­
ÅCJ6Bc^:! x«"l¨4Ò;H'0R
ù<‚F6 æÜJèxÇ¹}Øç™ÎÑyÁ²Ìe¡SëŠ%|mÎï@|Ú@ÿHÉAâGi¹xÚJt©Õ„+ 0¡9cù EáöÍ>ÄRÄ5æÿ4÷Ù2C~Û¤p»£xkåußu&D÷Õ+¼!ãn@—ûãW/;V©­‹ƒÈàJöÅ	¢€+òómzå®Ô5ÊÛÆèF?kw3ˆèê$‰êŸl)Thl,ìXÌ‰ÂFöˆÄUgmYuÈNşüÅ™0öM)tºd`+AmPMö{]’ Sx]ğ<w„çBƒ%É¡1&³åHGsÁOâk“ó«Õ£Ğí_Mí]}ûät9+å¸Š¢d_=íhtß/0?ÅØò"ç X+ZE_Âã¦8Ûo¶/oui¶ŠÈ-šÚÎ‹b v*üamÄyÂ+Çu+ù÷í4)«Îa¡pÊVÊMIq@~r«®ßd¹$#ÁÎÄÜ#w¹#b%fx²ˆ`À=sÌ+{¶êpCS!ŠOÃ@ÁpÑ&¶Õ6²Nãd`¬úÚ#DQbsu HB@TÈI"päÊn`L¬¢ÑüJP_Á© 80T™bá,*\ºE‘LõhzW×ñBêJb•('ÁYÏ½D DCíî`\ğ¬İ¶H8lmFmuâ ò-ÈñÂDd¾‡qOb´tïtgraI`o§hx–Ä¤r¹Ï¢O”
dìUù6£ ØîØ
G¬ 0Œ'Xf‘õ¥uªÂ›sAfáL•<ä@ fÓ#HiC³cë,j€9p©¨Y»~úƒ7°E%J}X'BlT¬Çe(ç):°#ÃP8üïl„Ï±>¡¸nt•¦B9h7š õf¢<cÏaq¡)5‹ÿòı’ é°sÃ†ÀÀ	í…$a`÷IpoéŸLÊëà(‚s“¤rÚ «N#¼[Î·-–¨q4­T$0aİ€cOReµQli~“y"u–9x æX(ó:9'\ HFÒâ’ÂÔ˜ÇyK˜ô[m§±@~ÌÑŒ ø­¾
w<y’t¡YñLryxbµ bãü‡k.„§±éò~
Ü|-Å)ÕDÒub¼sQ¾Ñ7N²fl æ/èRÈ<gä´ô;³äüA’Iû-:8æiÇ{q±5(EcŸ,(??Ï·šùl§d-íñ}V9t`¨J,éƒÃ¤½GfÜ¤§/qP$ëm^„+`äáœ#LÁm‡ÀŠ°Æ­) Ìè
úaË·Azaœ"Ü¤]ëBŒYİÁ2b7]DàhkY”pRŞû­P[L!ãù©ŞÍÓÍi@Ï2Í@'9ÍA*ƒ%(aBa4<ï(CHŞaLanÎ`k!I‹UE`y°±q7õ…0f~‘{z	!•"á!±qÀZÚTÅjUN®}.1`:…û.	}a0£Ù {ºÖõ[UÆ…BÂ»ç¨:oVüü¶öƒqnJSJcÌR¸q•ºD/aéÎôÅi®EësBÔäE`:Ùˆa³eVÖkj„8Û!r’^Áú5dó&%¬7?Šu(ÙöTiŞHğáë«¾9
!204(¬©1½ëu!ãâwÙf$×èÙv^nBzÔ1P8ñ,HYáÂjs±)5$e^‚|ZcÂflàã²Öi|mDé|•g¬‰Aª‡h1
ëÌpÂÏĞo^áÒ£>ÁÅ] UÃ wÉeÑTol2Aş~÷èCm|qV&â§gD¥[ÂhejB"ã8­îxm/€ (üÈwúÁlƒ…8hà€¸4e¥¬­¯¨)d´{ë_óZWZf4îÊãÂ?ùõïy‰™tYNÜIĞl!Ó´‰oH‹óÀœ=rKpxGÍ`r{Ê4rZúéécY!F„ÑUÙpÃYiË ¨„*U•”ˆ¬(Ràˆu18§…Ê  ÍDŞô%(gÄıCô#NØ
F·[mzÇ¦>qÉ47Ÿm¼Ä"\ßrd¸däpuÊ ´ñeRÈGëVIÉó‹;4é9‘8ëPÛ×ëH¤	Ÿ”³ÜS;œfQ|BÇläŸóè4Y=A®ú¢Lå£^i1Wcáy`rØ£Itä¶úå”Ôò1& _¶mõòyiQP(xºx‹èfÊ$€Æi@` âÇ> 7 :ˆ3 ªø1ö¥°íB¾²gBH?¥#µˆ¡6À©k¸­Z‚;2ûôû$®`FXz?Ó8 p¾éƒÿ ÕfFhÆÄæf@ÛúáÙ )‹ÊÑÊ‚ĞÙ?ªf,ivŠ‰b¢Û"·TŠ€…¨Š#%°(ˆhFdQ zÍ«¸qg8Â¡By*f°ÿUA ÔR`Ã°t‰K¿?*ğ$¦›b>áñõPVFÆÇ9JqÆLOhëŠ0"¾&{Ê.Ñİ:k7k!´7È¥=ŠH©c1<†òÌ°‹Q³/@êÆƒ=ëââ_È7J‚ÂDTjG@Näy<ó#… I]µ/·ò¥]¯gGì/v$õĞéÜÓÙäG§í ’ïGÌz"ÅÕ°±}Ç_Í8· †uÚ ("­I/­£ƒ„®‰baMQ›ªve˜	¶ ‚nî<PBƒ`Õ›:ÈŒ`XwvHÕmõH0ãpMÆi|*Œx¬hp½Ót©ãmí#Ù,u ÷ÁÉw$Lş ×p@ì¢  MK'¬ğ3ÍP6l´(ØšSÿ¾½i±$f­¹ÅµHpìÙ"ù|ãFÀR;eÄ:Wê+-í.´×è```V¤=òœht) J.rˆc”"Fl¯Xs,Ã}+ÏAØa5TRké“ ]Œš´ƒ3ÑÇ!kå [1Mé”}'ò&4M¶mŠaUQD U à#=–ËêX+ZÃUi‚o¤„Ëğ`;‡}¶t÷ËìHlÂ¡µsuK é÷^aõëC)eƒoPc!i´æ—@	Åøè¯?ÀWdÛ-ô¡gIÇií˜e ))`@qçuÃRçå1_fÎ4ƒÇj@ãUâœs‹­gÈªa#ı?PuFBrlñáAC’ş¿¸¯aFd)1aZ(SN`a:§.	=@ïHª¿M-ëoºeìSÄ(¹{tU^‰'N—üØ?`amãdñstl
æg!ß¿f"üêw¦(íN"FDt â—Ë{<nfŸ|^lw¯[pÂçuÄ'dR]i™Ó{…@p{ßjo(÷Ó‘;pRFæĞiéÔívW+H‡8ÛjÒã6ü4!Jªñ.ÕóZ¿ê%Z„Jmf"å®ŒAc?rK³éŒÇ‡…ñ}°+üƒ^Êï‰6@Ôi–ÁâfÇ„ÉŠN0}o1ÛM4-ÊÃW/m=?\È¨q€[€À %hÜ©5ì†%İ.~$Ã¤s{íßØ¯\`o‘§M´uŞ+H	«¼ùAàcmæ¿ìÎ˜py(  õñ@™„Ì’»®öñ#“±K`|Jî&#Ìò$}ºæ  B‚3š-ÒeRİM£zg¬g¯_Ö5]ÑÌ,Ğx:hAÕgÛë6OkT[OK^K\§øñ$:„¢¸¦3‘‘fhîHL·vÛmMr»ŞŠË£_Ë&B ÷‘Hï1^>uª²óJqN=;,qo:ùL˜!tµõø6)¤I%ÔuËšB‰Ğs	DnZ<à!/ø.çÂ~x»$mr6y3h><ºĞWr«6Ô±(+':,ı,ïöõ¨ä²`_FR0 åÜqí(a=lâ³Éí8÷á– öB¤SÆ`[‚“.MdRb›9àBØî‚ƒÏR3À$I…­E;7ízodÌ©ob×ÔæaiEL 
Osw¼@ìtéßòL{:ö!3ş^DuG;ú}×4?|P&ºu²î²Ás#¸ elyä‘8PƒoyôujB½ë|ztp@1¨¡ı…'¹ûç\¥KêÇ`/M`œhœg¹-Ü ·pXEŞ.´Í3(âõ™Àp	õo#l}š å	ÜXª¤ğDø¦3)%Íå®Şˆ º¯&õ/_BœâĞ5JQ™ˆ¬H"2K9q“´€ğÀñıL*õsíHZàÍ¸YßóÓ  ÑgÑÆÀ‡LÎ‘ÌAkpšjƒlùn¼‡á(}³„) ¢²3È)C8©`n K+m!(*2%Õx0b#[Rx—Ôõ4":‘7ÃÊ&çP°¿¯®±x¤û»«aË({X¾E/É¡:L¹u‹Ä<$l·(vÓ&*­¢º4ÿxm.tT¹<¢à-&¯7¡å–;†Dê ÖëÍ|VGL!„(.RIùœQùcX¤¤Ío ¾a`šnå¤Ö!)^Q€htaù’±r)5”=“èáéhs"ÿê?FI I¥’oütN%HÄIÎÇro£\B‹„&ñ%8ÊE…Ç4×%"9ÖÀ!x°í@Âr&+gq#¬$/¼^-9 ’¦t¸m)w,h@’ØŞw¹~×-íD”Qá*qRl2UÍ@¦a<hÉ¨Ä\‡x$y¨¼gRpëûÙrp¹¯3"f¹ˆJhBÅMÍî }2¡Š!SOš<ÀŠ
>½MI.¢Õ³Û¨@m‰3îÚ-…«#€\ï)~†ø¨“Ë Ç ÈO:€RåµUß9Ï!RÎDG›€Zè¸kªô¬B]°°"BCl>…PÕJíî1ÉÉõ$·Øl\±7ı+Æ,Ü¨U!¨•Œ/&´/0ƒ
~.Cæ…uW*È°Ã' Ÿ‘ğx0ĞgI¥=0eùmÇè`Íiˆü(`nä©2Ä×jÄyƒ.€æ|V˜J=mz‚z¬šJîyé±¡ğ ¤$‚JC.k4'ÌerV(l~Xx!©*xi:ÿ`øe½a‰ºµ³
±®P¯„Æ
(š-®P)ÄÜ|·dÉOØ-ƒh4&`•Ğ¨¦„ Ù¢6DCô şÒ'8ëa *d_åg¥İÇn+ÃnHâ"Ğ7Å]y†TAHº!â»¢à]@).^»®€E’[—Í%ŞÒ3•B4:ó!øz›ƒÙ)¢ËhãKB–ì}&áp|MiP@ãJ,QVtH<ı-k Ä
®N &E'T°h)ù0Î ûŒ¥ÀØ¦™ ğ+}I‹ÚF›vq…‚!Hìx™gz{ @."&$,ÜEÍ‚˜Gà{á¤ÎO{V*ÿäˆiĞù»2d×í£'UÈ€ã&I&5èz>ñâ#ù,¡èİ³` è~¾ª@+ì¹Ÿ=ü¤nOİº³Ï.™çâÀ¨¼{–5µ!?I‹j¼ê*P
`ÀÉoï 8¶€Í!·"BW‡ ÒU!¯åÜi\Ó9VPS¾Ç ò‘Se}›Ïk	5Ë¼p€‘
°ìÄrnCù?!«£2éÏ€w–OZ¦…=8|Qà{R(ÓQŸÉ ‹Jß×’$À6©3*Yy&´WhéM`Ác<5­ÒÏ¬/a©e­f¢)À£&b
CNª©;Èª¸RuÃ$1.Êi„‰”w"Ò3®ö°…dóŒÒ¸S3ëU:şao£P/ĞòZ›nÎ>6L’±‹xuƒ" ˆ" "š½a@öèBZë7riÃe´\¨@|Où}vİuæ{ic¦Ò" 1HÑâiãÌøu%j¤H'EĞØo¡i§f7°cšá,Œú…Õe7°^*Bª29ƒ½:›7›4ªíz¦ŞfÎÛğA)ËÛ™hYæíä BÆÓÕ-¸,A¢æîoeu
ƒFÉçèğ†_Å`Œ¢I¦„Ù·®ú»âq/Ú†¤˜p£¦âR??B!d¨@ëÏÆöûÛ#]ew	ö]è}àõñbÿ#pC‚Øb/$rsÁŞ3AÏ´;n{~b	‚ÿé,À€(sÓ%z%Ïşìàæ0ÿÂXúĞÏÊë`Ñ#¥	±çé[},¶ÎûkSqğûô¡È±¿!.ş ¾œâî–azEÂ`qH,{p"åK	Ø_ÈØdcég>H9*) C08tË9ıj›[¸ 74ùá¾ÓÆ"Nj÷5—ù¥&+›õA_fğ¤m¾E_ƒ­ê¢Apœ°8†
~}ôœ-®¬ä5 J^ñbxät«˜ŸmDqK™˜Ö/•°ÍOİ)éÍòD•“*`­8m$§/ª°¶Š¤ˆ.Dó€h[¦¦`oEN{j6/àûer}6_Âfk<1©4mVú2/øfû¼aìÂ`Fd¡H[xâ`C'@ªeaT9®è"imÊ!F+©/'©2uLâ1 ¦ä”†dÙ_,½“)g2?2cÎ]1V°ƒév¤Fcd±€zêo~Lw PÚ=‚%QkS}*a«¶$¢+7"ƒ²`¶V±Á¸e©^`í½¤U¶2—šƒb}yÃbÈ	abm8TA…ò >'j¤³BÄ±*‰ê(iœ=€$Uqó4ê.ÈsLı#Eœ.ç+í-ù ùˆŸRhAŒ ¸" (ı²ÄE{‰«7o)yì³=ÒfsúaõƒÜäuü¸Gr<¬@"oõN00Öä6ğäO¸C¯Ä)’~ÃÉ¡Cà™u¶07:¨"H1ã¡t ù!ˆ¯Ey¨ù/|)zÓãÁÎèfã1İ:ç0G[ˆı0å’ë "…Ä+êÆ¯Ş UOËâdjD¡’^ù‡ØO2zc£æK‘«˜+C†FûRÕ#£4§½8EpKĞî
0j®Æ`Q#¶Tx­óÿxejËòeq2Vá'íù0wĞ&"Èd¤ìe\ÆIçÆM¨®h"+±¡õ÷Dò›íkëYÏ´Ş©Z#IÄ40ƒf•£SJ}2z$ãí¯Y›ãC=	¢¸`¯„¨Yj° l9•I ùÊhñ'mì÷ÀDÖIIwt"€ûHvÑ*``Şˆ¹i`qi$TCKä"å'«œo°Šöb•tuÈ?]qFDxÅÜéÈ\:’j$âñcâNlB5´yi$aj<s*iBú@ôª/ıçÄ.E€,YZ?1Ú«ºmN¶úIs2;,,Åk}R‹^‰×R‘GI`4~¦#+L¹1$Š•\lÇ¿Y C2$pV\/Ñ &ŠÜ‰\yTqr[§ã:Ü1–É/ê%Ë{€a›‹ôdÏ_ƒ,¡"GÀÔ$L[şÓ 2ø™ Öucâr­X1 ‰ñH'Ê¬q@TGdëäú(G"I`
N ıÆ±ò]¯»ù[²‘:"™w}s¢¨rÉı+ƒ}l¬'éÒßÿøÆ)Šô*v®p|`‚·l%µ…lmšÉ…{&6QG¿¤çñ`şæ’‚M¦»$B£}'8eòSÒ“b†7d©íÇ±ù-eq¢#S<=A14„ü¸$¤ Láò  ?êbx‹x0tÄ«ŒK¤¹sºÛ,o^a’ua.ÀHfÌ X‰aïxmÚ ²£ğ¬o©câĞRbò"&¬rü¦‚cğtí™ê´dÚWK7"T$5!°"¶i6*ó ²P,A’)‰£0R…”ëhAË¿N×÷¶‡yGÂqFf
lØ8) ¶Šüe§*Ë
ıô„ˆ’#´¼ NU7óAÓ*wNv¿Ãö «C2 ˜{Ø%|`TGĞ¹ÇDå ¥N(# üBIag@d‘©[x®Ó!½SEQ õÏqMaYoñÛ´ áo³4µÒë}£Kh÷¼ÍÅY¶r «"•$)}6™í40yÅÙc²~ŠïiıŒ5 *dÜJ }›¶=a¬Y lÃM"¨7}U©‡8l‹ªW¸³=°tZùöqv8'5Bg°$(Q$p±‹’,!ppO Ã ¬áÜgìVw(íyH¸Áç@,¿¸n·xMÔ4Y2õÁg÷œìwE`¬dá[Á®‚ÂèÕP§?ÔíáÔck©m?~êóˆxƒ$f°qÂDúØ£(}	À[ª±1Ãaôj i»Gpég&4´`ñ
@'&şq¤@aåc!2kcˆC[¢F}(Œ¡\ ,2iÌÓSHCÏ¤ÁBBÍV"|Aõ¬1Œ°ã%@¸Ô­F4æ¤ÿÛüå 4NåGÎÎîmÙ¶z‚é® 1OëÔ< Aêidcy/âÅvŒad%c”ìlSîq€» K0¬LàS^lnÕpko ,GT9n·›¡ ,+]V­ˆªôäŒ|ù{ u €p(j4 
Êp€jÊ$‘p2r”RV÷£¡åÕLi…Î,}êjÕhµ42O ï\ªcã*"  0,cFË¸ÎªJpæaˆ”"

 ¬†&P°@#(¾şg$jè€=×°=CË~V9nñ.ËËôJ4¶$4Ğş7°H!´“* …tÅ°o*ˆR£êUA°’³ m®glºE{KT-k¾ñ†ßÁ{ªÁ® Œd¡W8‰Ğ,‹’$_zÀ×v+½çá:ãöÏÕBuE%¡i`Y((#2Úø?7,&ŠE  *% wuIv.Î)SÆdÁdhûcëÇ:ûÀĞƒÃd¤ÚzCŞ)ZW}ÄÊtHÜ€I»LG*2\^"yÒUŞ8¤™‹ñë,'g:KaáÑ"lõW‰! ¦ğ½(™7ª ˆt8`A¥F‘-z)Lf’wjmC€¹mhåYN^Ys6»#ğ!9ô.oİkÂ9Ó*Ä¢’‡t2<ïE 1koèÜfo4ĞxKÎ pdlKäcèK"Mò°€X O}Q;¤òhñ–Vêior/;©ÍĞd«SÅ(Tƒ¨8™ân]-Ï}V}c e
ÒM*ó µÍ¾DÉ(Ï3ä;å³QøñÈq_Yäu;
÷·Ñd[–ò'NJŒÎ°X L‹œÓ§N_¼·¡¯nS¢9<N(!r9YÓÁRGñË!«ªPÃP!^¸ón 77(mEÁ;t´¨¦+¥Ta„hÜ™Şn0c ÆkxŒJqªè´¦Zrê_îLK{qBÛ^á!c«ë!!©p°@¤Hr/BMîtÍEV9»\&\`ıGöög?êA703rÕqpl¦ù±$œEÈ§£?,z»=æiëæŞ~R9<w
•€'ı"[¸¥(ip Ğ1¾;júz(UkÖ£ÚÙÉ5†4½&üdAâ¥ÿ^4ùQë_ -¹R‰Jª¨€:4piÏ°2)à•cğ»»Bk2iOí <r’€h·öF­Z@F&ºöntíeRõt–k\ÍF€µS§Éwªqë­R8# ]}“ÒJ/ÇÁ6¥%¥&ÅP:vj"¦ÌL!XíÔ<a°vNÙ‚ÚÊ-çÑ‡? æ- =ÚMüeÀôn½,¨Pel@-wÊó]`Z»iÈ`şG£¦°,,(DB˜/°a}Š©lßuEvZô ],f~)ºàa¦Qønñ3Ãkw	Vº5@ûL}„Œ Y)!ÚØùócöX¨!Z¦.fOvçI›ƒºn%K¨X t7,YZŠõ±FWåáª`jrN¨jgxë¯@ì{&ÌÈµÈw(Ï³ö{p*{øü7<”àîÅ ÀR3'ûXµº)? 	ø!‰d!âABq|Åğè=LbNkh} zÙ~‘¡í=&Foÿ$kÊ¦æGa l¬˜æM»
bº<
 1 ª=¤Ğ€WQ Î'õaTd`BĞÑVfœ°`ñíÀÚel`îsè2>b9­\ZLÛdW>*ZqÀSŠ 8µÎ :4Ùc•\õ+­îlûÙ¢8ŒæçEàÏn#4^ÃPÉE°’^Óe»°ào‹âB =1c¼­”›.AßlšsaYvëØöİÎõ}û–mœ)#Ì@ÉI°ô
f	W?¢¥a!©"Š¥Şï6sLm2rİg)o"çi%&ãQ[)@Au°ÄB‚Ãm ystØpû'¾ !p5ıòw.ìu€ûpZc[Sb*2z®C®j­š?e¯måP†mÌ5nlğ“'égåsqª¸2¤s ô¡äˆ)Ìcèğ,
W}%Juêrbá’­³æ’k1Ò°og``ía6àëà©¥IËuIN)á¬qIßL)|2uH2f&Î%b)ÄpÈd"R2ë÷IO·º¨s°fBw¦oÿlaüa}«|}¶¿]ãTåJuËZ"£~vZn¸E=à c+í¨#r$8rA5_ Äu’QäcËüHe(+ %ÎqåGäWvj%) ||¼,£eİx’0T°El0ä|dÈÕl cU¶Qt$q?œÙãÏt0·ãn"¢lpfåt	áÅ¥aØñ7å(±g~˜À%Ü:ğt*s
!î1Ô$OLi¦)pÚmX@Ñ gô^á7|&†!Bòò+@¸â¥‡½G3í"#`1§[
" d8e UúKEF£’j®mxZ9é\(¶ Pw!Æ4 u6Y³ Ht*ï#^Ò|üAaúÓèøä$3pg¨a·7chÜæ{Rjd­HLtÂ0e:vA¦u¸xía­X:Q{©.á• h „¨âî!quñowWh10½tÖj=eŠ !&1ÕW½°F„*tcE>,rù$%ïåªUc¼%¥e<:" ƒ`eyn¦JôôÏğhtmn0´QD.6 •vRìã¯ô*İ41Ï\DxÚ’í…#Â.Fg÷!kX¤£,w«$Î '°!96Aôdæg¶`áx±uše™î™PÀ³Ìe­Sê" amÆMp,j@maèÀâ9xÛ…|)õßm p¥yc ñDA rL2`7¦^~öÀ3úÙ¥p»o¯xk7etÿ4&L7å£(!æ*n@–ûf,EW/:F9sKãØ JºÏHèà;öñLpc¯Å—ÄóÆÀn7gó3Xh¥h-ê·m`M@(dèHÄ‰eV÷)ÆUfl uÉNî0hÅ<uE(tªä`+€iVM–ğjU2‚zv}€8w …g+!ÆÇ%É¡5'2åICGsÀM«âs“óªW‹ _Hé-m!çu9/ä¾à£$_$İy4¿+1?Ğq#r0I/RE}ˆbó¦)Ûh¼"¯h§ƒÌ-jÛÎ‰bD	u:½aÕd›¢+æM!ığoaiÇa¡02’ÎEI3a~b)}Qó&]d¬$^#ÓÆä 's/y£befy²ŒŠÔ7wŒ;™’`p ò!Ë áxU Ÿtv²ğBûedpúÚ‹d%}`2wuğlBPDÌM0cìÚî H]åZ ğıÊX]
A© y0 (âá­lEªEAjÔìxcrq@kâbUyW9ÍùE%TCnÿîa<(ì}#P8,iCmuãô<	sŠd¿†{K DT•çtoraC`ë¥È%$x•Ô¤b™ÛfO4ìeûw£"¨ÚoÜCÇ¬!&‘}eXn¶¥¥]¢ç™SAöñ)!Y?dN5 &S«A-'ñ!k]k‚}vª ]N»~úÃ¼qu[õXgsv\¸Äe!ç)z43Á\xv¯l”Êµ>¡d¬"V‘¦@¹cwÛ ~õy^b>+!ua83„ûä]R 
ÚsãGÀr¡Mda`•mT5É›^ku(ÆSÅtÚ.AªD'<[ìéí–èm6­Ş!0cùsmRlõ1nlV«;Py3_ˆ9x>ô(¢2 ¯9vPwbğÔøRyfi½tZìä±L|üİH¸¿öŠ"<h”øõyùÌ2y=ba½¦Fóü\§w>Dv%³o .
œd+4RTÖô#¸aqxØwÖV”4Fíè/íTX8î°>}³îêH…Hø/p9ækÅ}r/5(EWcŸ$$,ï¦˜i,¤%-	m°529Taàlk®Ãi¿F@n¤í7Nsw$û^, +IıÁn#<ÁéG>Ğ Ğg¯(È¨Ò%¿{Ió"Üä])Q:ŒxÍ >r5 ¢€+q´pVœ{›q[l3gø©KÅ]id4_P 1ä1+ËÇ5dELñt<q `@Şs@qlnOµrif]wC=“8m+ô0fz‘`>	2 ñ‰sq`!˜Œz.QUV¤}>1`°TU\ûEp]Oc$²AÙ0y:p¿ÕF%ÒF;ãª>å$Rxü¶ÔqjJcªaÌA¨s•à@'1©
ø€i"çnÄ¤Mj*hz²MrTk*Å8ó!W=Âê¼aS#17=Úu
#œ¸ÖP }Z`à”±ín>2a0>\i¬ 1½á}ÁvjvÙf„Í`f||":2qi1ğlOY8ä"é»!œ44e’ÃlKKæ†r&*ğğ²0ikta D€5•e°aA«Çhkc@pBöYiæ¡ÉÁ]$yã`È-ôVnl3À3|÷èK}4ybÓ,â-A\±Kâ`ejf!ãz=5+xmgà$hxÈ~r¡L!„8l,iÁ¸$g¤®3şó­mµsú3ûjWzn¾à3Â>û°ÿp‰ÆuYiÔdÙLÔlÊ¼AO,«óÁ_40jğX‰``óŠ4rH:y Â¸S”ÑØ9×6qÛ®„zYa„°„ì¡h¨ö1ç˜F 0ÍfßµkoETİWç+xhG-,¶»m%.N¾1@0!«¢í¸T6\ş:0@8DÀ.p•‚4´µ`R(Sïnáû‚x ®8³KxÚ÷ëR£Š¼3Ü3#•r^Û|D<«de—vl½,92= .b£eqÚgòhRcíÛôzx&aRä¶êì1Ñr1L' õ0»mõõUkXX(e¸=‰èVJ,Æk@H"¦0¡#À ¨s\‹x.‘á…TüF4²gCQ^6¥gµË!FÈH¡c¸­‚9t¨wû%¨À&<róÇ{³0z£ ‚¿È•fFhÔå€
FÓ áÉ$P+ËÎ!Ê£<ÕÑ)ªo¶nI~ˆbàë3&$ˆŸ8À„¸ˆB!´t9™ÈtdU ~Më1bgmÂğ"f°iÁÔA ĞwbÆœ0tÉyk9è*ğ&æ¥›">é•ß
VTĞá9Rê]hkK ~neˆ?Õmzwk!05l#)ÏX(c#>ÒşÔ°íÑ÷/ ŠÂ-ëâ )Ê7J†æD°&„GTn`y³3„U±%2ªå}/eGt 6dñVù—øäG•)Káz#ç`ô15åA
¹uÜa²­I?§å¬ª
aM$E«šre½$ n®TF AD¹ş¨Œi 1+r/ÕeÿY0ãxmVp\„Œx­xZ#qT¨c(ä#¦u°gÑicgÌö—Hèr¢B!]P!®¸ğ³	 -ô
|ŠM·d}z0$4œqÅqÊ0´ùvM@ÀZ~EDş1EŠËİ<+o4×Ièp p__¥5íP9°h/r k”&Bl¦B\2|ã}+šØa<XcÙÒMŒ: iaæh• K5dh!r†5o§m^lUUd& +_?vãhX2Zƒh§<$„kğ »—u0tuÛåHê!¸2´	i”!åWie‹#@f)cB5rŸ@	—úh ¯5ÀQP›u £gMÆœa(	$"¹=c@teõ‡r£â1FÄœ÷'z@AãÕ¶”q›­E%H*amP1&Drsaaã O¼ó¹o:­!F µ%áZ)w*ja.>—.)}Pl	û½!¯gº£lRÔ(5yöE\‰#m•é…Z9:èaéap2tøb¦c!Ô?d"¸*q¦)í`$D4£ 'Éi<bç]vlwªkØæõur"dKEmU{Ãq[o“bû+µHƒ;pRfçñ}ñm­wUo}Î
,Ò—µ}01ª!/Ñò¿«vZ%Ú`F eeÍf;A“á‰Ë—‡ôw²-üÃRZ} Ğia ndÈ‚.06E+1ÚMqòët‘?VÈíq€[+Œp 1.şáí5Ù
*T&€j¤s{ìÛè¥@oÏP"§L°uL¤0M	/´ÙCà)qä=ÜÄ˜umy, €$÷ÁPùvÈM,–®*¯òq Ï±Z`jÂî(~#ç°4Ó¸®eÄ ‚°0 ğ R\G£d"½eg ­^Œ·IÃ¬|ÔrjjAÕ-yo>#$M+*GX¶¸ud¶„‚<._‘ĞìhÏhL§"fš|÷yK`³ÎŠ‹£	&C —I{J>5Rzj
9N78Uf:ù Q $3óø j4ı`5}öqA B˜P2rDeZ=va;]xfçÂzy«%5rwQ;È>şÔvr¯®34Õ³i+"<ı,çášñ©üÒ8exWRü¤ls*Qáı|Âğ}˜7ñµ $r Æ Qb£¿Ohbã[9ôRYŞ»G•3ÂV,h6g;ìúo$E­rÇüâcaeL$Nc¾óÊ­u0[âEp«¶!sd_/C»ÒY×´#°|&ºu¾k°S)<#-dy<à™BÒ=m´U ¡,á!xpp`4 £ıg ;¦x¥O¢Gh~]âØa°gå#œ<?piE #´Ms,"óœÔq	 µ.?eìyOª¤çÿQª¤pGxn5pµİÕñÄƒ 4;:
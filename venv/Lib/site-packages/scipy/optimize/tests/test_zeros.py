import pytest

from math import sqrt, exp, sin, cos
from functools import lru_cache

from numpy.testing import (assert_warns, assert_,
                           assert_allclose,
                           assert_equal,
                           assert_array_equal,
                           suppress_warnings)
import numpy as np
from numpy import finfo, power, nan, isclose


from scipy.optimize import zeros, newton, root_scalar

from scipy._lib._util import getfullargspec_no_self as _getfullargspec

# Import testing parameters
from scipy.optimize._tstutils import get_tests, functions as tstutils_functions, fstrings as tstutils_fstrings

TOL = 4*np.finfo(float).eps  # tolerance

_FLOAT_EPS = finfo(float).eps

# A few test functions used frequently:
# # A simple quadratic, (x-1)^2 - 1
def f1(x):
    return x ** 2 - 2 * x - 1


def f1_1(x):
    return 2 * x - 2


def f1_2(x):
    return 2.0 + 0 * x


def f1_and_p_and_pp(x):
    return f1(x), f1_1(x), f1_2(x)


# Simple transcendental function
def f2(x):
    return exp(x) - cos(x)


def f2_1(x):
    return exp(x) + sin(x)


def f2_2(x):
    return exp(x) + cos(x)


# lru cached function
@lru_cache()
def f_lrucached(x):
    return x


class TestBasic:

    def run_check_by_name(self, name, smoothness=0, **kwargs):
        a = .5
        b = sqrt(3)
        xtol = 4*np.finfo(float).eps
        rtol = 4*np.finfo(float).eps
        for function, fname in zip(tstutils_functions, tstutils_fstrings):
            if smoothness > 0 and fname in ['f4', 'f5', 'f6']:
                continue
            r = root_scalar(function, method=name, bracket=[a, b], x0=a,
                            xtol=xtol, rtol=rtol, **kwargs)
            zero = r.root
            assert_(r.converged)
            assert_allclose(zero, 1.0, atol=xtol, rtol=rtol,
                            err_msg='method %s, function %s' % (name, fname))

    def run_check(self, method, name):
        a = .5
        b = sqrt(3)
        xtol = 4 * _FLOAT_EPS
        rtol = 4 * _FLOAT_EPS
        for function, fname in zip(tstutils_functions, tstutils_fstrings):
            zero, r = method(function, a, b, xtol=xtol, rtol=rtol,
                             full_output=True)
            assert_(r.converged)
            assert_allclose(zero, 1.0, atol=xtol, rtol=rtol,
                            err_msg='method %s, function %s' % (name, fname))

    def run_check_lru_cached(self, method, name):
        # check that https://github.com/scipy/scipy/issues/10846 is fixed
        a = -1
        b = 1
        zero, r = method(f_lrucached, a, b, full_output=True)
        assert_(r.converged)
        assert_allclose(zero, 0,
                        err_msg='method %s, function %s' % (name, 'f_lrucached'))

    def _run_one_test(self, tc, method, sig_args_keys=None,
                      sig_kwargs_keys=None, **kwargs):
        method_args = []
        for k in sig_args_keys or []:
            if k not in tc:
                # If a,b not present use x0, x1. Similarly for f and func
                k = {'a': 'x0', 'b': 'x1', 'func': 'f'}.get(k, k)
            method_args.append(tc[k])

        method_kwargs = dict(**kwargs)
        method_kwargs.update({'full_output': True, 'disp': False})
        for k in sig_kwargs_keys or []:
            method_kwargs[k] = tc[k]

        root = tc.get('root')
        func_args = tc.get('args', ())

        try:
            r, rr = method(*method_args, args=func_args, **method_kwargs)
            return root, rr, tc
        except Exception:
            return root, zeros.RootResults(nan, -1, -1, zeros._EVALUEERR), tc

    def run_tests(self, tests, method, name,
                  xtol=4 * _FLOAT_EPS, rtol=4 * _FLOAT_EPS,
                  known_fail=None, **kwargs):
        r"""Run test-cases using the specified method and the supplied signature.

        Extract the arguments for the method call from the test case
        dictionary using the supplied keys for the method's signature."""
        # The methods have one of two base signatures:
        # (f, a, b, **kwargs)  # newton
        # (func, x0, **kwargs)  # bisect/brentq/...
        sig = _getfullargspec(method)  # FullArgSpec with args, varargs, varkw, defaults, ...
        assert_(not sig.kwonlyargs)
        nDefaults = len(sig.defaults)
        nRequired = len(sig.args) - nDefaults
        sig_args_keys = sig.args[:nRequired]
        sig_kwargs_keys = []
        if name in ['secant', 'newton', 'halley']:
            if name in ['newton', 'halley']:
                sig_kwargs_keys.append('fprime')
                if name in ['halley']:
                    sig_kwargs_keys.append('fprime2')
            kwargs['tol'] = xtol
        else:
            kwargs['xtol'] = xtol
            kwargs['rtol'] = rtol

        results = [list(self._run_one_test(
            tc, method, sig_args_keys=sig_args_keys,
            sig_kwargs_keys=sig_kwargs_keys, **kwargs)) for tc in tests]
        # results= [[true root, full output, tc], ...]

        known_fail = known_fail or []
        notcvgd = [elt for elt in results if not elt[1].converged]
        notcvgd = [elt for elt in notcvgd if elt[-1]['ID'] not in known_fail]
        notcvged_IDS = [elt[-1]['ID'] for elt in notcvgd]
        assert_equal([len(notcvged_IDS), notcvged_IDS], [0, []])

        # The usable xtol and rtol depend on the test
        tols = {'xtol': 4 * _FLOAT_EPS, 'rtol': 4 * _FLOAT_EPS}
        tols.update(**kwargs)
        rtol = tols['rtol']
        atol = tols.get('tol', tols['xtol'])

        cvgd = [elt for elt in results if elt[1].converged]
        approx = [elt[1].root for elt in cvgd]
        correct = [elt[0] for elt in cvgd]
        notclose = [[a] + elt for a, c, elt in zip(approx, correct, cvgd) if
                    not isclose(a, c, rtol=rtol, atol=atol)
                    and elt[-1]['ID'] not in known_fail]
        # Evaluate the function and see if is 0 at the purported root
        fvs = [tc['f'](aroot, *(tc['args'])) for aroot, c, fullout, tc in notclose]
        notclose = [[fv] + elt for fv, elt in zip(fvs, notclose) if fv != 0]
        assert_equal([notclose, len(notclose)], [[], 0])

    def run_collection(self, collection, method, name, smoothness=None,
                       known_fail=None,
                       xtol=4 * _FLOAT_EPS, rtol=4 * _FLOAT_EPS,
                       **kwargs):
        r"""Run a collection of tests using the specified method.

        The name is used to determine some optional arguments."""
        tests = get_tests(collection, smoothness=smoothness)
        self.run_tests(tests, method, name, xtol=xtol, rtol=rtol,
                       known_fail=known_fail, **kwargs)

    def test_bisect(self):
        self.run_check(zeros.bisect, 'bisect')
        self.run_check_lru_cached(zeros.bisect, 'bisect')
        self.run_check_by_name('bisect')
        self.run_collection('aps', zeros.bisect, 'bisect', smoothness=1)

    def test_ridder(self):
        self.run_check(zeros.ridder, 'ridder')
        self.run_check_lru_cached(zeros.ridder, 'ridder')
        self.run_check_by_name('ridder')
        self.run_collection('aps', zeros.ridder, 'ridder', smoothness=1)

    def test_brentq(self):
        self.run_check(zeros.brentq, 'brentq')
        self.run_check_lru_cached(zeros.brentq, 'brentq')
        self.run_check_by_name('brentq')
        # Brentq/h needs a lower tolerance to be specified
        self.run_collection('aps', zeros.brentq, 'brentq', smoothness=1,
                            xtol=1e-14, rtol=1e-14)

    def test_brenth(self):
        self.run_check(zeros.brenth, 'brenth')
        self.run_check_lru_cached(zeros.brenth, 'brenth')
        self.run_check_by_name('brenth')
        self.run_collection('aps', zeros.brenth, 'brenth', smoothness=1,
                            xtol=1e-14, rtol=1e-14)

    def test_toms748(self):
        self.run_check(zeros.toms748, 'toms748')
        self.run_check_lru_cached(zeros.toms748, 'toms748')
        self.run_check_by_name('toms748')
        self.run_collection('aps', zeros.toms748, 'toms748', smoothness=1)

    def test_newton_collections(self):
        known_fail = ['aps.13.00']
        known_fail += ['aps.12.05', 'aps.12.17']  # fails under Windows Py27
        for collection in ['aps', 'complex']:
            self.run_collection(collection, zeros.newton, 'newton',
                                smoothness=2, known_fail=known_fail)

    def test_halley_collections(self):
        known_fail = ['aps.12.06', 'aps.12.07', 'aps.12.08', 'aps.12.09',
                      'aps.12.10', 'aps.12.11', 'aps.12.12', 'aps.12.13',
                      'aps.12.14', 'aps.12.15', 'aps.12.16', 'aps.12.17',
                      'aps.12.18', 'aps.13.00']
        for collection in ['aps', 'complex']:
            self.run_collection(collection, zeros.newton, 'halley',
                                smoothness=2, known_fail=known_fail)

    @staticmethod
    def f1(x):
        return x**2 - 2*x - 1  # == (x-1)**2 - 2

    @staticmethod
    def f1_1(x):
        return 2*x - 2

    @staticmethod
    def f1_2(x):
        return 2.0 + 0*x

    @staticmethod
    def f2(x):
        return exp(x) - cos(x)

    @staticmethod
    def f2_1(x):
        return exp(x) + sin(x)

    @staticmethod
    def f2_2(x):
        return exp(x) + cos(x)

    def test_newton(self):
        for f, f_1, f_2 in [(self.f1, self.f1_1, self.f1_2),
                            (self.f2, self.f2_1, self.f2_2)]:
            x = zeros.newton(f, 3, tol=1e-6)
            assert_allclose(f(x), 0, atol=1e-6)
            x = zeros.newton(f, 3, x1=5, tol=1e-6)  # secant, x0 and x1
            assert_allclose(f(x), 0, atol=1e-6)
            x = zeros.newton(f, 3, fprime=f_1, tol=1e-6)   # newton
            assert_allclose(f(x), 0, atol=1e-6)
            x = zeros.newton(f, 3, fprime=f_1, fprime2=f_2, tol=1e-6)  # halley
            assert_allclose(f(x), 0, atol=1e-6)

    def test_newton_by_name(self):
        r"""Invoke newton through root_scalar()"""
        for f, f_1, f_2 in [(f1, f1_1, f1_2), (f2, f2_1, f2_2)]:
            r = root_scalar(f, method='newton', x0=3, fprime=f_1, xtol=1e-6)
            assert_allclose(f(r.root), 0, atol=1e-6)

    def test_secant_by_name(self):
        r"""Invoke secant through root_scalar()"""
        for f, f_1, f_2 in [(f1, f1_1, f1_2), (f2, f2_1, f2_2)]:
            r = root_scalar(f, method='secant', x0=3, x1=2, xtol=1e-6)
            assert_allclose(f(r.root), 0, atol=1e-6)
            r = root_scalar(f, method='secant', x0=3, x1=5, xtol=1e-6)
            assert_allclose(f(r.root), 0, atol=1e-6)

    def test_halley_by_name(self):
        r"""Invoke halley through root_scalar()"""
        for f, f_1, f_2 in [(f1, f1_1, f1_2), (f2, f2_1, f2_2)]:
            r = root_scalar(f, method='halley', x0=3,
                            fprime=f_1, fprime2=f_2, xtol=1e-6)
            assert_allclose(f(r.root), 0, atol=1e-6)

    def test_root_scalar_fail(self):
        with pytest.raises(ValueError):
            root_scalar(f1, method='secant', x0=3, xtol=1e-6)  # no x1
        with pytest.raises(ValueError):
            root_scalar(f1, method='newton', x0=3, xtol=1e-6)  # no fprime
        with pytest.raises(ValueError):
            root_scalar(f1, method='halley', fprime=f1_1, x0=3, xtol=1e-6)  # no fprime2
        with pytest.raises(ValueError):
            root_scalar(f1, method='halley', fprime2=f1_2, x0=3, xtol=1e-6)  # no fprime

    def test_array_newton(self):
        """test newton with array"""

        def f1(x, *a):
            b = a[0] + x * a[3]
            return a[1] - a[2] * (np.exp(b / a[5]) - 1.0) - b / a[4] - x

        def f1_1(x, *a):
            b = a[3] / a[5]
            return -a[2] * np.exp(a[0] / a[5] + x * b) * b - a[3] / a[4] - 1

        def f1_2(x, *a):
            b = a[3] / a[5]
            return -a[2] * np.exp(a[0] / a[5] + x * b) * b**2

        a0 = np.array([
            5.32725221, 5.48673747, 5.49539973,
            5.36387202, 4.80237316, 1.43764452,
            5.23063958, 5.46094772, 5.50512718,
            5.42046290
        ])
        a1 = (np.sin(range(10)) + 1.0) * 7.0
        args = (a0, a1, 1e-09, 0.004, 10, 0.27456)
        x0 = [7.0] * 10
        x = zeros.newton(f1, x0, f1_1, args)
        x_expected = (
            6.17264965, 11.7702805, 12.2219954,
            7.11017681, 1.18151293, 0.143707955,
            4.31928228, 10.5419107, 12.7552490,
            8.91225749
        )
        assert_allclose(x, x_expected)
        # test halley's
        x = zeros.newton(f1, x0, f1_1, args, fprime2=f1_2)
        assert_allclose(x, x_expected)
        # test secant
        x = zeros.newton(f1, x0, args=args)
        assert_allclose(x, x_expected)

    def test_array_newton_complex(self):
        def f(x):
            return x + 1+1j

        def fprime(x):
            return 1.0

        t = np.full(4, 1j)
        x = zeros.newton(f, t, fprime=fprime)
        assert_allclose(f(x), 0.)

        # should work even if x0 is not complex
        t = np.ones(4)
        x = zeros.newton(f, t, fprime=fprime)
        assert_allclose(f(x), 0.)

        x = zeros.newton(f, t)
        assert_allclose(f(x), 0.)

    def test_array_secant_active_zero_der(self):
        """test secant doesn't continue to iterate zero derivatives"""
        x = zeros.newton(lambda x, *a: x*x - a[0], x0=[4.123, 5],
                         args=[np.array([17, 25])])
        assert_allclose(x, (4.123105625617661, 5.0))

    def test_array_newton_integers(self):
        # test secant with float
        x = zeros.newton(lambda y, z: z - y ** 2, [4.0] * 2,
                         args=([15.0, 17.0],))
        assert_allclose(x, (3.872983346207417, 4.123105625617661))
        # test integer becomes float
        x = zeros.newton(lambda y, z: z - y ** 2, [4] * 2, args=([15, 17],))
        assert_allclose(x, (3.872983346207417, 4.123105625617661))

    def test_array_newton_zero_der_failures(self):
        # test derivative zero warning
        assert_warns(RuntimeWarning, zeros.newton,
                     lambda y: y**2 - 2, [0., 0.], lambda y: 2 * y)
        # test failures and zero_der
        with pytest.warns(RuntimeWarning):
            results = zeros.newton(lambda y: y**2 - 2, [0., 0.],
                                   lambda y: 2*y, full_output=True)
            assert_allclose(results.root, 0)
            assert results.zero_der.all()
            assert not results.converged.any()

    def test_newton_combined(self):
        f1 = lambda x: x**2 - 2*x - 1
        f1_1 = lambda x: 2*x - 2
        f1_2 = lambda x: 2.0 + 0*x

        def f1_and_p_and_pp(x):
            return x**2 - 2*x-1, 2*x-2, 2.0

        sol0 = root_scalar(f1, method='newton', x0=3, fprime=f1_1)
        sol = root_scalar(f1_and_p_and_pp, method='newton', x0=3, fprime=True)
        assert_allclose(sol0.root, sol.root, atol=1e-8)
        assert_equal(2*sol.function_calls, sol0.function_calls)

        sol0 = root_scalar(f1, method='halley', x0=3, fprime=f1_1, fprime2=f1_2)
        sol = root_scalar(f1_and_p_and_pp, method='halley', x0=3, fprime2=True)
        assert_allclose(sol0.root, sol.root, atol=1e-8)
        assert_equal(3*sol.function_calls, sol0.function_calls)

    def test_newton_full_output(self):
        # Test the full_output capability, both when converging and not.
        # Use simple polynomials, to avoid hitting platform dependencies
        # (e.g., exp & trig) in number of iterations

        x0 = 3
        expected_counts = [(6, 7), (5, 10), (3, 9)]

        for derivs in range(3):
            kwargs = {'tol': 1e-6, 'full_output': True, }
            for k, v in [['fprime', self.f1_1], ['fprime2', self.f1_2]][:derivs]:
                kwargs[k] = v

            x, r = zeros.newton(self.f1, x0, disp=False, **kwargs)
            assert_(r.converged)
            assert_equal(x, r.root)
            assert_equal((r.iterations, r.function_calls), expected_counts[derivs])
            if derivs == 0:
                assert(r.function_calls <= r.iterations + 1)
            else:
                assert_equal(r.function_calls, (derivs + 1) * r.iterations)

            # Now repeat, allowing one fewer iteration to force convergence failure
            iters = r.iterations - 1
            x, r = zeros.newton(self.f1, x0, maxiter=iters, disp=False, **kwargs)
            asserU,€o)}ÅU+ŒKmãlQîPf%©€€ Zí6ğ‚ARA¥*°ueys{öø¨63Õ,(Š1œx^Z³óÍûëği¶OéæUe)‰Eg(ÕxÇ1Íøc²A[ŒáATß «)f“qâ•©¥ç%¨!Qˆl îí²WĞ8ˆ_Š+  È ‘ ¢
û,V%Æjvé}äæu“ÑAYº­ÏßûòîIÔ”:ñ”}{Z;y=® …RoÎ)^DDü—$§1ƒbƒ¨ìš"H'ğï¡ÆTähfL8S$ewcjW@øÃ„–ÎkÃe¿MÖ·ÿ  ,­€¦'ò:«]©2 ¡6Ùé]ûäø¹‰yÎºŠ$28ô l¨ 0@”Éîñ‚„_ÑÎ¿vã~IQ8=DR1$i+S($9l! Šhj¦¢@®0šŒ'D%¨e}pş= kã&ieŠGÅ	‹¦p>’!?á0áQÔÕ)”m\kY¿àL`6Ä[‰>× †]12ÚFâú¬)3+X@
d›£@Mc¸dÎ ¤ğ
VêúHjd°Ì¬`ğŒí§—äGpÕM5×Ç› ŠÜÉv·ü~êëŞQø;´duÂôÑGxØPDÏÛlDï
«—áİ·	K0-`Şk®¸òEúqéÊM°G”ÑQU»Ï•uÍ"ì.eIMH, ›lò1„'¦FN<=·`gÍCÕa¤PRÅŒ­7‰n
¾88Â¼µ ”c°ôdT]0‰ l@nñØp#lÚZç;Z¥à†±fp…_gpÛ_{Tñ·[Œ7ÔU¦“`Ç_|B”›dî¸¶í8[«L“$—®²ÏdĞijw¿Òmu[t]v# ÑĞû´5æmş½B+‚1¼° ôºôAìBPhù:y‘îZH¢Â}VtRy&4¯wÆ„–Ì³Œ(zc‰T†gÀ°£qÉUx~'¡?;«2FG!ï´ s1{e!ñ)&Š¸fbÏô=r´g×š¯JhŞıšÖ¶
‚^’èáU¨V#äK'E•ı4ÿt[ìfüo=äœ±„D/LK­¸<Â`Ğ.É0èJ¡ª©á Îæª­¨.xGU¬UC’[ê\œ2wİ×¡aM®aIôj—¹»a1O^ÑJXC½†²në² æà| •˜,#k+¢¿ÂŒ0"›V¬!¯¦|Ò8‚	éƒ\ŠH ë)® Ä¹B€È¢İpØr7y#Í[}´ùa¯Vy|Éæbr<í\’qW)\h9ˆŒ… ¡jø·ï[òšü.SÕWKÊ1¥ ûÖ ¾«Mw¿£)ªŸ`		A‚òcYSÖDÀäñØ^IÌväàé}!^ÎtııĞú'xÈhP0V&t*Â×M›xäïï€wû{ğ_;EmIAEVÔéŸ‰&éÄâÚ«¦°`µıVVjÎdW{s…¿P¿j	qµgyHzmK#|Í"L6}«ä¾f]#ï”¢O?4DD<l2öE•ój´~UW¸Pn.4îH( L`bªèUb0#åÒ&FºZÜ/¥ÇäXâ­Ëdø.—lN/nOq; \t‚&Å‚¯8;¡&{)Y5@¯®>ğø9{`"ø@Pm“ã«XRû$Îà†e0àP”#pf!÷#í§© eí-cksÂS&oõøbuObı´UUücÿAM¼‡Fjåwİcˆï!Nx‰É³×‚Ìrc/@à›%«¼™c` ’‚áˆ’eX”@"5«ÂHm.«Ö0×â…¨r­gÉ9ì¥$7Û$1'ø(É«qa!iÎcz“Hİ=¶47pmú ûh’ğá/„g$0‘Ê$‹* sàÄß ƒKˆjÄ ˆ Œ(qñ“¼âúÑyÔ ùjí¹İ‹f  ‚ßé!}UÉ±Ó›‘ÌXK.‰wò¬â¦7á[ı§zA5bUŒ2B#©4¼®ğ$ñÒ*!¸„¸.N DíD æ«¶Ëiv	ŸÅ4ß©màĞÚíî0€¢Á! ,'"û//ğı„Jåüt¬»b£©—^jHµ…Ë›‚o’TæŞ/©0bEßjl¾Ä`@ 39(‚ú(®!PQ›‡LìÔã|Ï'Œf½ºR¬cze[üo:wîkOÁA$<RrZw¨_éTn‰ò`ç¢¨¡ (Ï €@6k¢x¤ bñXÛYURM _¡Ç^¬,Õ¤NŠ ¬²9ÏBgKoïìÏµ)-*¾ç„™uö÷çÜL““ò+oU ä:¤±Œû0{_èJhON C6ğë}y¼ÖÕÒjIRLÌÚº6-:=/°3„&QğÙ!’%CÊ5övVê{k!LÓwÈ„úìR€×–dy&À"xéD¼@Ö OÌä¾¥ól-C·03„:XKidµ;–Şô>l×8t`ti^n4Ô ¸4iPd}eQ{ŸÊ¶T0”0âº§38jĞŞc-3m™ùpû˜äº ñ01B†
LüEù¸]8$ìÄøB&ò J$…êæ_.x,ô[áEdçÑ2Ï·mm;øË¦k”¦? Ï”ğpá¹}!…'<0h±pÒqD5( _ko»0ÑAoÆ3ı…@# ş®P¥GãxKHÙÈq´o±+Œ4ŸxX0ûk™Ô)êíÌdi$„V!Ä}'²!h+„@¢2Œt@I»75=Ôñ¯ãÁ0;®$.|&t_¦DùÔgèdBqù ÌhG h95Â¼¡Kë¨Ü“´KÌkDz€à˜ğ‹ëÒ¬g!¢RjÆÿ®uî½ì$01JY+nû{‹øÕ1a>] 2|}†ØIÀÜ÷$Ä!k
°DFaŸi'¤2
-ôÈj#Ru®ÄÅPGî Êh%µöosQw¶ã:Š¡ üÛªêùâH™`Ìa5ˆ "5#]¶õ‚HM.@nÂ0)ü£« ó @2oO”ÕvÆÀw"· -ä‹Ê®m›¤Äó86D(€.ñ<ñ¤]¨vaôõ´g#Æ 20šGí½Â1f@ÔiD)Õ0¹KÅl˜ ¢ˆĞğsB"Çñ7$ Uƒ¿Œ\_´hDAãÒ`"‡N•Zx¬o±L)ÂLåŞEÛŒ
ÆhMU¨—íár=[Cf'®|>Í¦åú°<ˆf	²ËD©Ì) Wlu`«ìÓV‰^Ÿ‡…@ÄCÀey=¨Eüuîoeiê,ÅE¾–ª°¼~UhóvÑRa¸–¹knéğBc[½E ò=¼‚aSvÏà{¨"#õÙVaª>ä?ÿ±H
ìisîZUm°çf@vmm,¾`ØGØ‹BèñÀEñŠ So}ŞG«î±ÖV‘†p2pá øz*tÌ(HX:&ÌG?ıjÍUd-
ø9C)´«äÊb%¼sO²LrÚQhKœÖÏ¿|%ó“Z&Á4“â	Î0 Ø¢©+]“ø  uA2#' !‚æâ’Ë ¯;»áºaöî]p\á
†d€±&Î‚ ¬}â”¸ Ìlrx±º( ŒJ2$Ú@‰†æyû¯t×C@Ingò¥,jar8 z``ä¤yß9¡º’'!À¥$À9‚7’;nNTÜÂIÒ§	ò,â°È0¿Pq[ZålİÿITd"4H/kê$ù#¨¡îM¶keÅÁ~d^Ş^¥èiÂOÛ†`(Yr/d-8ºzÕRenÆ`dI3	šK›5€Å!‹…""i18`(Pƒ(cÈÎîêÇÏ~m5däÑñ
Ây8’&ÌX¥@¸ é²ç›Ë^€wÌ"2ú­t2l*bŒ(Ü`-P§LÈª€j)xKÀ!"¢®¢°xb’í²q\@3M"°„¿Œ\†Ÿçæ› xác@+Ngÿ_§Š'¡*QÚk¸ªã›${¿UDCrdÕ¼hpÙ7+æ
 è¤:cQTK8 ìQï½°kìJŞ-ì¨?Ü0*!N"¹ÃãáHz‚õ1£ÿCNXïVş³Ğû{±IcoeYf' ,bS†÷§¡ˆ¤iÅèmüÖ)ÖxjÓ£ƒº1Ò@ìOd.UßõÀd®‹™ŒtğzçX0àf:Én%2“*ŸAÿÇ¡8<^ªx(#%Z•,1v :iR+.û1áõ¬·©»$níÙÄöfhÌ	Sxd)°ÒÛ)+I‰L(JÂ9…0{¥ŒïcN)`êŒ&ğO|#<ª($+P$WçV7ò "G™X³ÜZ³ pEjÆÖ/Yz,»êëLóH2.p¢Ën E•‰÷Õ¦º©Ä@â²H%âòo¦Pµ:–iğßkğùjÙ0â(ìç£â£5$eùõb NF]k(àAgY¢ÄP%\Â`x—2”g«b¨rz q$4³RZ&2—üƒ,rËèê·~¬¦ãŞ_T2J4¨,xb¯¹cœES(Â~¼,¹¤af‹/di›Ê(Â·wÌ‚Í,Õâ"‹à¼&¡,’ì¼5:n/º*p| Ç <R.RÆ;š ±GuËÊc·ssŞcıgçŒC:H]ånğâ{ëyE‡:¢¶)¤sòiZ²~üJ62$zTÆŒm-(î¤-œ#«3#¿ Ï¸„"ºÂ½²ĞËÒêp‘$¡9¼·á<5€Wúg1¸¸´k…:ÿ 4 ¶ºYüöïUÜapÍz= n2z-6ÍwA²Uİì(m%4ğ5(9 I9 MÛ$àhÆ¼I^{Väé¶“†f*(²s’}Kåf¢œùJ 82¸5ş¡Íä¬NÏ$€P YÂj*AğÇ!¼ä²uxVHÃy²´¤š•5O\kC‰É”oÃ*“FÚa½œºu˜Ld)¾XB«p)t¹6ë0Œ2”oÍ-[åÌ8"è¦L±O=,auä¹lj$aµÌ?È(;?ªgã]öd{;ã«3õÆ|#1öÆ"°jvQÒ0Ix´®@E#+Ã0U3ö6fĞmf*}ƒ´°¤—"Ú_,ºÈdu!9SN]–]!\ë{Ñ´Çlöó&NnË“g²~t^p¹Ò!Ó®
Md8)§du¨tÍ>´Í.²qãEµ«vèÄn9èòP®kË€Ê¦8¡ÖnÀr:I#hƒÌ^n?<y¾ñRŸıfÇ,h{Ã/ÒÂQ µF9HÄuå!Zx¿0ãmôş¤Æ.uGÈ)ô**=>¯¦rË\´äz%v0ã(×bs`zÇQáO"óát6­Teq:F?&+¬jé©AæL©ç rqÑçœ"GÔÊ3ÿ"} öYÿ¡$Mª!R.¬¡¸	01‰fRÓÁéù
w»yg~~ƒ9N«Dıt	/jˆ’ÍD"ãs‹_ôEäØ&ãz¢mc^;]EØèÃpÛIFUŒŒ'“ˆĞ3b†fÂ7åà`Iœn*ujzª(ñ+N¦R$iÓ¥rIç
îñ_E×ÂæÍ­\ÛCÉ „áuEoÏb)PÇmŞsÛ nòU%R¢Hª2‹ê÷aªz¦ò!ËÃæe…Ìé2•ã—¬CÒ
kªD‹fhŞÉªõfÉ%‹bÜ ıîÔ!]HğÙ¬rEUOêøˆÃ¨å¦hÖôK ñ²¡|±:QfÊî,]'bu Šõ~ ÌÀ
OZ0›#^¸61+„pø1Ô8ŠPd5!½¹Èa…g[0Òs­™k^à¶:	q@ğm³=jåñw·ø¨3#ôcµÔ<85!çR€Ê‚{[oGÌç— äp>af³`‘K­‚€2¶­8³<¦g€,hl"½17 Œ0è¬ë•Üã;ıÔx0âÎô<X'hQVk’Nav1B’¬A÷p6ÕP;N#`í{‹	mçòàb}¬6eÿ¸x¢taOwo">lä‚pvıx6VÆ`ŞBT
 "è+¥F©Ÿ 1cd“6A'6W6À${mê8õ#ı0dƒYü191Ú­V)£ó?øô¨RD#:X­ae8š% á=ìøFSĞÌÄcî·.ÑKù49¾á² Bş;8-º)ê¸&ÖU’6:B¿åliVlÓ1p¡ıa2«ß !1tX*™¤è¢ ·$ƒ`¯ò#4Oğ!$7Ñy¡ç5ş}`&Ê$RRÈ´0=X
P]YSı÷ù!@nGà<ó!ã:	qİ&.	ª"¼,°²&ìd8•º,h~_ùƒTI?~yÄb5å"·m§&?öäAÚi™J·$ÂÜ+Lñ™›8.úCÕµ‡dÆcVlˆticçao¢‡ÎY0  F;Câ)8ŠÜÿ$H‡¿Ñ«6Sâ±f?òˆHGŒyD ,4DJ[ÜÂUx|¤Kì~Ñ·¼pĞ¥1i„¸C[õFéw}yIİt)®K9]%Qéœé[=~-ısò½ò¾¹atsp)Mã8My;6¸ÓN'o¨7ìl=ÄZ*:×tpÌs˜æ©UÂıpm¦ÈI eäèÑx…I"±#ùi*"Ï~×au½è.Fó¥uõ~›Ï5c	 ÂOv4ü<!"±-ğ'àL-¦J`Äï`
/œd,è #€¸qt‚¾xÑ=(2soÔxq Lìd¡›Y4˜_|ÙĞs4­ b²9E?êsŒe‹$æp,€æú6ZÏ«tÓŞÉÈÇ`!}Kë{ê.é¿L.Æ)m¨ğh»€À, €¹(ˆíd~w*­-õrÁôbOFyÅ $:±!UH.©˜JÂ
ÊR`J29ò,1HüktÉGìŸ9
¦²ş¡r0ŒÎŸ}Ì
êmF÷œ…Ÿ|Šşèp2V7ì— áxîĞ¦pÄöÎimnÄ`ØVíTƒfòİrDòîD'1sÎ-kÕxa÷Æf]JŸìâ—c!: ÁÔóÙhè1âÜüµã==v_¿h[dºfKÌz@›bÕbxyÀ{kwì[ /K)b1<#Ì9©ûõx»dæÜd³i·v@lã!‡Bï7GÀPUEª-›¾##™yS§œ H{Î  sÛüJ;‚x¸£B(›)°±“8İÓTføÎÚ\YYĞºûêŞGw?Ì`ö^ó",´×P/0ïƒøm_‡+0¶òÿµîbiÆ]ñ<!&x»DAS‹Y@&€Å!NÍÓ;‡$<›#‘½$8=6Ò¸¾¡½äñ8­qqÄÇ„äg6Y#!¢eXqÙßqÃ#ÌÆ4ÅGVlä9İ
5¸ÃÖgD*DSKËë á@Ê‡P6ÏK2à©æÔÉ/^ˆp£@€³£ÂLñÕ$™ øœ34t°‘F=KÄÛ±`¬:ˆwºg(‘&`¥e ¸­y9á¿z8€¤¨‹¬ö™½ª% äŸ½‚A¯¾-ÏAX‚ÓUJs Ç†X¨ "?¼,nA/JYô¥£àbM‰Qg.ü`³0ëÂK††8dÄíf0ªõ‹.igˆáÜ-_åÕ&í€Ç­äP*KÊMö¯ÿíkÂ.ÕUbouèx#à³AofMkïO×£Nfb×dsf(æ9]B$ıoJi`gè¦@ƒy-è§ñÈ!z"âH"’B‚p:@Æ8\™î ÷Ù¦Cäc|‚eÑë*sb€YJÜ.²‡û£¹½n	Ç¤Ğ€”<°bb7H¼Ÿ/-­Ç3Eãx.µ*&TÕíà¹,*(˜%âÚi‡$ò(4¹à®_b¤ƒp"¥šB
5©Ï .›¨íìˆ r£&«¡/ÇôaÅ!#ï2>Em´Ìe#óòï;ŸãñëùFbîüè!:kÓ1;mUnÎú@»^kµ$ä½cn‡ZSù” ;´*M©üè{V_EÄPt8ÿíĞĞsŞúr1@NIa~oÛÚ~aŠâ5q‚dAW|lÕ=’6àUy/nkWüoM ¸%6 °D:$2¢ä¡§¬@Û`hE’÷eÔ>	:£É îXd¹™<É4Rsx1Ä ..ÏÉã«aû9pøYr N$‚Èçˆ^¡¡d…ÚCWˆÑ»ÄkÃæNNç[mü2³ÖÌú¼–'PUN{dxm‡½,ùÁ~½¼8P0¬°$F6%˜
:‰È+¿ 	I³'°ll,FRPc)ô
üª›"ÇfÈZöAMiÕ=şK
 ± ƒjnòrÑ¸.ôw(§QIMp»iİ¬»pqqí ^.`J"g„cTcNØŒé]U{®(1Œ›œÊAs†òáè!zĞ¬¾("*:ëa,j…çK
`Ÿ :ivD-$è0¸¢0;BD¬âÃ& ¶qåQ<˜™ç°{i	¾QÈ-© "|‚äñyÇôwdxbX$êbü„FBÅ(’híëÀUj¨yN'†æC•bçìl_6Š*¦[£*ê^Ûòm*|´SÖñ‡sÆ0|·>÷rDU2``DÇFB^<#ë4ûp\¹™åièÎZ‰_µeº¶Z6Ô[
§*£\§ê7]£V˜6¬j$,MMªH¢IÖ÷¼fäÄFËÅŞ^ €fï}6ydÇ6éğ·í.YÙücÁ)ŒWB¼_yÄŒ
(rCB[– N,à^‡ÎßÄgb@åLBáD~!fä|kJ³
I uN
ûî$›æ9I"àns¦a×tÒ{‚a+6€ÒWÆ©ú;;T˜pº ·ô!Æ2õà.nªuÈûPP5_"®(tŒ¯I¤Š?mêÉgz¤ûeÍw2lÔ¡¬£ezPRî¾ Šå)^ƒ Ì¾şÒèÀ‡RÆ	F<`uşJ‚4ë’­„tşE·~f	äÀ+g&ç3 Š²Ü©³+x( {×~Î”ş±>5E7¯ì'6@ëhş8p µí2/< ‡¹M¸>ğ`<ÀçîQå+øLuíB9pŒl”Yg²JEKø +°1rbæ4]Á4¤Îl•E©Ö¶É¾_`÷?¤ò}xO}^Ùt™è²¨0lOÂ!?"Ho}ŞÀ÷a-§è,^˜»ë`ccô}djÜÈèxÏu¢1Ñ a ÊÆ-œ™qíBQåÈ{•$|ag°SyeÂól.ğw oâfìº=p ØY6n=r(h®$åri~AKêV_+Š
iIóz%dz„q»´ Â•Ü=İ¥á§“lW0¸kç%Ix¯t¹<Âv eÕ|j0}j¤é†ÈÒ*ãÈ"(;BŞŒh]ÊÄgáRcè58*øpk6òo?m—
yÒ–Ê;Şä1fÄşu”NÊêï-1 ¸"ı«Ì¡p`üP'  U+Œ)Fá*exÇ¼¯¤şn¬²ëA±!Ö—mêyq:b°.>ª( p0g1Şïş0T€4¡tãC
<b"yĞ Ûí¯_N¼%üû çÁ@Myï{¶üÚ€™ví*§Ñİl/tFÄ2R¬·,ëå¬rï~Åol.…Ç&Dg$~A@Hîq,4ø$Ö9är[aù|fdti1ï:h¡hÇ™=ò‡xN±S9G²-d~ÊËpHhşmplº@»JùÁÒ`EyíxøÄ}˜UÅe!@Æs~	 Ì02ÇßD–İs&êÊçP«‡N¨O%áÁE¿POT—õïÜ –0n—»÷]4'O'ËëÒîJ¶ (ª¤Äp-;ğ£•Ôª èÓr™üÍú<Ìì¿<98 (-ÌA¬øÓ–ô]dT	M™O¾rœe™†(]‹µ	Ôy?=~·gn,‚agLy'@¥Ó.AG×oèY!‡ƒäHr3“àWõ kò£«¤ •eììMYù§D$1EÅ÷Êh~=-bŸjqVÕ¯óiÖÍ9n
M_M£Ò§I¸jÀ.+5ˆâz¸=êôš»cp)79u]”¾Â*¦%+ù²lp4Ûçe<xî3î$Y``ëbO»Ï®\Øp_‚#ÓşÔí%É#|"Q²ÉÓàwü
é{ÃºaBb@¾?ãÁ!±kvşÕW¯x,î[%TìhúƒFDs¥±ĞHAD_ÈQ28dÂn&íKEöVêàøh@1ã®(x0Tºğë&&¢G›@Ÿàz`Ğ1ùCğôjTm'Õ-Á( ¿ÌMNÿær»ïô¦b(-aC}sì­ pÄi„$l5Ô}I$¾Öï4'~jN{}kÆqªÒòÛÅèI´:(ğEØ"$ºO‰ÄìÓUI*k¡Ÿ%0h²§M¾Y™QQüõ;KH=®U<iİ±H+	ów`Rg†ujâ¨_C¹ls…·ôEP]ûZrH`\²Àidà%b<3ÓNzùµzÔ–µ!ój`r‡¤F…l9É¸Xù]^¬69d.©=;8ÆÀªAŠ,ñßgË…’’€Ë/<1nOoƒ›dÌ{è>ÂQ“~röšsãT	<IôßeØèu8½L+w>sÑ1* $¥dtN…'7U+x*ô*¿$9ch)Q_ÒñÒeØJ…gN#’v_æ¦¯æÜUˆJó»èS&3~dOÜj©qñÎt{>pÇğ¢|õøQ¢l(ˆt¥£á°z°j¢ÓÅLĞä-+u]¤skLº`Mî-èe†sh»ºö+üíîJ‰lôa6-$aİ}iá™9,T[m—&rqá¯²ùh¯d+íğ3		vDndëI{ı	E ¿CJÂ¤©#JjK$¿UrÀ+FIıao+KçdğkPd%)€è pZe603ÉA4"°tl}ayölE© •,!(járx_ÔY;c{oóïğ{¶)­$ue+E>exÎ¬™c€oMæÑm¼« gs.Sâ•­¥í¨) È#½4êù³ …WTi8]+¡Óu(x!	Ñ 2A–?,VæfSyoöçu§‘2C]š=ßß[çî_Ô¯‹”:˜ù}{š>?]µ$$ÒnÃ(EDüÒ4
1£bB*#lD_*è'±ïË·`¤HnT:C!$e~mzQÁšÓ®ÎôëÀm0»I÷DŸÿs<kÏÆ/û:0uˆ*6ñ6o5c_»àp½MN>%ê%2(ôllà(@–ImKoÑ‡¤T‰Gî¿Vá81	¸9@R!b#ksxä4=Öt³´Jb®nLş8š?Àu%¨ ]õl=(is%dùÃCYÊ¦ >zE"ëváeÔ ­4Ë@½`p>.Ä€)>— Mq1a’bª¤yrkXGF+@7mC¸ÄÇ14ğ
Vìú2lbdàÍ¾i¸Ü…ì§²@3`ÑQ}!2Ÿ©r5ü|âç)öx8à4„õÑ!¸@Pd¯r|EçK£¡•<#¸0.l@Ø;(¼wKíséÊ	°a”R¹O0u$ ¬`qä((!Wl ş5'2E EW\Ûl¿`OgWa%PríŒ©Ë…ïJ¯¸9V¾4	$bµô T]°	X0ÄPŠ$‘$0!|úñu~Íp¦sdf0$X±}0Ô¸·Œ?Ô9§ƒ0Õ,B¹ƒ»hş›/ì:0O	ªc$²î£Ï$ğil`›—åt{4#^¤UTr¼wlKwµb«–]²£äû°ñ£BP(e:z…îÚL®ïâxFd &n¯3æ%†Øs¬xjc+ 'Àğ"}AFZ*³¡=¡FR!ï´ Ww±£{euq!)lÔ¸bgtıp¢ğ/ßŠóB0hŞ|šÖ¶
2öš×ìáU¨[+FÄ‘lD•ñºÿ}Kx1æõgm¦˜±ƒU`5(K­¸' @ÄnI0íKñ«àá îf‚% v |CGÔSê\UšnrW11L•Ì`
ä)—8:01KVØhZ:½†ò"ßDngG²÷à} ×İ-#j#á¿¦œ01&^ñc®¾ xÅ:eIìƒ~Šj m® LEbeæÊ6T
YĞèrvy;W<sW9´y =×*)}Éà 2´¬âñwnhw=9‰Œ…AZø¿O_úzµ}İQGŠ0‡PãŞ!¡²)g6»¯1ªÏeMQP’òí[Réd”ĞÎƒIâvF`é>Cm!^Jí}ÉŞøÏ|tT'P.BB_\ä«ï r›{â^e=AcpFÜ‰[ˆMHa¦iÊê²£&°0±èô&cÎtwsq?Ğ¸J0p¥MyHTz%!üG *«äºpE"-?”ëÏ>3t@<ìr÷^%¥ã*¼puQ8@İ/6èOJ Leb0ºkİc±cóR<Lş`-%—¤P %‚då&—dh-½fJñ+a`$6Ç„ÿet;±Zb{.)•P¬>"°°¹+`"(@%P¬“+°PV¿uLl„2tğğô#z ¡v+]iÇ8`-¬)i+s"(¥0beI=âù4UWÊ#¿¾¥ÄœjDwùcD:í1mEy‰Ù9ç¢Ìr!`Ù-»¼Ğ2ë!­–¢a4wxÕ@b6çCM­n«Öp,VV¢UFis-Ì±î¦¥¤wÛr!gğ)í»qe!h^+ r•\]=64#t-o 5ÿáÒ``m‡c„u˜4O¤+ôSàLì_$Ãmhò"„Š*pëq¼âïÓıuF ùz¬™Ù™d`Ã_éal7Îğû¯Ñ+¬‰cğ5 —waru§}m3bGŒö[94<h*ñ/Ñfo*%Z¤¸&F)DhM æ¹”Ãh{)—A4ó©} ĞX] æu‚sÉ # lek#+òeÅBñx/t¼;#ó+]ß×VjH30« g²bE¦? ²n5QJi¶ÄàI¤1;p{{,·¥-,Y+„h®]÷0Î]n¹²u a[/ÖôGt÷n;nÅË t01¨O­W^‹ğğAç2h¡À](Râ­P&{"yÆ¡`qX!ÑArO*_5ÇZì|Ål^şc,ğ9¨	b{mıdËq9ej®m?–Ù}ü7c-’ò%(OU d:½4^épúsËnbwNA6p)a8¼ÓÙRz )rÌ˜œú7988n¸SÅ'E²ù!EVâ5|k[p#h{23iò{}P “w4u$ô"<ÙäPF¹0Ë8Ş*·ói-spq…[P9Lu:–Ş¬¶m G8dh5yHf©6ÜdN½¥aPam< ;nú³u”2j*§+(ê ÖkI#IYùyÛ¼tºJ uu1Bw¦"LpEûµI0ddÌ|@>_ j$Ï‡ï,¿zHvôùCnJK—…Ó¶¿½(-9½³:¶{·çW?LG‘óå¹}!Ã'8qÅpxòq?İ40_Ëo9thÆ^«Kı…$ ş¦X¥G åhlmÙ9iügu+ø´½xXEs#½Ô*ªÑ¥g_	`•C7<Älm²•¼+ Q"pDÉ!7T½ÑuHn# 4`ªµ,ü&*_âé{u/ímpqñ©\hG!2K9µÀ¼©Áìäıa“ôKÅëpÀe¸ùícS¤k0ºrêFõ¢uî=ì$(JAmªZŠü€Wå¾Ğ (7`#–Ødˆ¡.À	o
òä%»c'Pˆ. -°Ø(BûJu®Äàtjî Êê/·23Pw¶?ş¿HËªcûòHZ`Ì 7‹p =!U4ñ‚ä\M«O¢’8)<±«-â!E6m ”¥“àf”#¦m%Ä[ÊtmÛ ÖáÍ<wvE,‘$s ğ¥èth<ï´%w0:1ÚWí½À 1s@EaD)d°	kA,c²MÁàqb2Ãñ%vCU:‡>lDT¼m,@åfCW‡N{²¬nõNÀLåMÙ(ŞJe8×m"f=j$&®p6u¦í~œ\’˜62çd©€w=,q`jÍçW	^ß§eDÄCÀ"aù`	ùEøqêæ%ùá EE®•âğ¼~8hgòQÒa½N»:ná°Bq[´Aåó5?¶2Sv­ËxŠ(uYPAÈô¿k»-,åm;oØmm£â!Td+~®şÀ‡ğ™FøO°ÄDáÆ{k=ßG³Ä 6–Ş± P/pé@ÙoBCºI:&D$—=z,ÍqtkŠü;C%´,Qdîf-u!P°lòØùlŒŸÎ|5±kZfÃ4 ó Î4C¸ú3r=[…“}80ÂuI£e¢vÓf]jÒOE(ï::ì-3µÎ]pmáï|ÀµbÎ‹­)â"´x¤Ì|Q¼³;x@ŒJ65Òp£®®{»¯VçJSKNç"rå+%ZDq( ,abä¤ñ!]±¥hg€h¥Ä9}ÒÓ2|nTÄçÈÂ¯ú,ê”d83]pY¨<İ1IDd2w@RkjùI}!z]¶n7ÖA
e4Îx…ê3¢Oß‡`lHdp½p :5xÕĞ$,À7x [9Jµ0ÅÅ#•'"i(`)Q§)aàÎmÊK~y5Us¤õ1âåÈ™&_üp@=Gäšk‹INAtü".ÿí_:hkãÈhR`îÜ§ÌÈ®(‚n(wn™@E#vpî"ûĞpz“m`s}`K3	 !¶A?Ü\àŸvå²ŸOXacf,Çã\ Š ¬(+ šk8%ç-GDpSr4õ,h0ù6c¶ i§)aA°8#nQÿ¾0Åstz^=ä¬~ÆÜe!+On¹Cbi¦±;‚÷NXëG¾¡Ğó{5Kodm4% ~+0‡ÿ'¡Ğ«%¤i øu÷Û«ßĞJÀ£ÜºT3’Düoæ8SÙ4µ¡&ª–Š•ÀvñÒnçY?#®l2Én%*’ë#Cÿ©8,ö0üĞ<‰%P½,3v"^>iR*.js&á¤¬§kñ6mé¨#ä6ä0ÌShî=´iZğ)+E‰d DC9Å0øBìlcN+	«(îm¾ôO<#N¾úz$+°¡7„+v	J